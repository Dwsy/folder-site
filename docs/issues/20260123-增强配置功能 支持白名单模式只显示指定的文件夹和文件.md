---
id: "2026-01-23-增强配置功能 支持白名单模式只显示指定的文件夹和文件"
title: "增强配置功能：支持白名单模式只显示指定的文件夹和文件"
status: "done"
created: "2026-01-23"
updated: "2026-01-23"
category: "config"
tags: ["config", "whitelist", "file-scanner", "fast-glob"]
---

# Issue: 增强配置功能：支持白名单模式只显示指定的文件夹和文件

## Goal

添加配置选项支持白名单模式，允许用户指定只显示特定的文件夹和文件，而排除其他所有内容。

## 背景/问题

当前 Folder-Site 使用黑名单模式（排除特定目录），通过 `excludeDirs` 和 `fast-glob` 的 `ignore` 选项来过滤不需要的文件。这种方式在大型项目中不够灵活，用户需要显式列出所有要排除的目录。

白名单模式更适合以下场景：
1. 只想展示特定目录的文档（如 `docs/` 和 `examples/`）
2. 大型项目中只关注特定模块
3. 敏感项目需要严格控制可见范围
4. 多租户场景下需要隔离不同用户的内容

## 验收标准 (Acceptance Criteria)

- [x] WHEN 用户配置了 `whitelist` 选项，系统 SHALL 只扫描和显示匹配白名单的文件和目录
- [x] WHEN 同时配置了 `whitelist` 和 `excludeDirs`，系统 SHALL 优先使用白名单模式
- [x] WHEN 白名单包含目录路径，系统 SHALL 包含该目录及其所有子文件
- [x] WHEN 白名单包含文件路径，系统 SHALL 只包含该文件
- [x] WHEN 白名单为空数组，系统 SHALL 退回到默认的黑名单模式
- [x] IF 白名单包含通配符模式（如 `**/*.md`），系统 SHALL 正确匹配文件
- [x] WHERE 配置文件 `.folder-siterc.json` 中，用户 SHALL 可以通过 `whitelist` 字段配置白名单
- [x] WHERE CLI 命令行中，用户 SHALL 可以通过 `--whitelist` 参数指定白名单

## 实施阶段

### Phase 1: 规划和准备
- [x] 分析需求和依赖
- [x] 设计技术方案
- [x] 确定实施计划

### Phase 2: 执行
- [x] 扩展 `CliConfig` 类型，添加 `whitelist` 字段
- [x] 扩展 `ScanOptions` 接口，添加 `whitelist` 字段
- [x] 修改 `FileScanner.scan()` 方法，实现白名单过滤逻辑
- [x] 更新 CLI 参数解析，支持 `--whitelist` 参数
- [x] 更新配置文件读取，支持 `whitelist` 配置项
- [x] 添加白名单模式测试用例

### Phase 3: 验证
- [x] 单元测试：白名单匹配逻辑
- [x] 集成测试：CLI 参数和配置文件
- [ ] 手动测试：不同白名单配置场景
- [ ] 代码审查

### Phase 4: 交付
- [x] 更新 README 和使用文档
- [ ] 更新 API 文档
- [ ] 创建 PR
- [ ] 合并主分支

## 关键决策

| 决策 | 理由 |
|------|------|
| 白名单优先于黑名单 | 白名单更严格，符合最小权限原则 |
| 支持 glob 模式 | 与 fast-glob 保持一致，提供灵活性 |
| 空数组退回到黑名单模式 | 向后兼容，不破坏现有配置 |
| 配置文件和 CLI 都支持 | 提供多种配置方式，满足不同场景 |

## 遇到的错误

| 日期 | 错误 | 解决方案 |
|------|------|---------|
| - | - | - |

## 相关资源

- [x] 相关文档: `docs/file-scanner.md`
- [x] 相关代码: `src/server/services/scanner.ts`
- [x] 相关代码: `src/cli/config.ts`
- [x] 相关代码: `src/cli/parser.ts`
- [ ] 相关 Issue: -
- [ ] 参考资料: [fast-glob patterns](https://github.com/mrmlnc/fast-glob#patterns)

## Notes

### 技术方案

**配置结构：**
```typescript
// .folder-siterc.json
{
  "whitelist": [
    "docs/**/*",           // docs 目录及其所有子文件
    "examples/*.md",       // examples 目录下的 .md 文件
    "README.md"            // 根目录的 README.md
  ]
}
```

**实现逻辑：**
1. 在 `ScanOptions` 中添加 `whitelist?: string[]` 字段
2. 在 `FileScanner.scan()` 中：
   - 如果配置了 `whitelist`，构建 glob 模式列表
   - 使用 fast-glob 的 `patterns` 参数只扫描白名单匹配的文件
   - 如果 `whitelist` 为空数组，使用现有的黑名单模式
3. CLI 参数：`--whitelist "pattern1,pattern2"` 支持逗号分隔的多个模式

**fast-glob 集成：**
```typescript
const patterns = this.options.whitelist?.length
  ? this.options.whitelist
  : extPatterns;
```

### 待确认事项

- [ ] 白名单是否应该支持否定模式（如 `!docs/internal/**`）
- [ ] 是否需要在 UI 中显示当前使用的过滤模式（白名单/黑名单）

---

## Status 更新日志

- **2026-01-23 22:21**: 状态变更 → todo，备注: 初始创建任务
- **2026-01-23 23:30**: 状态变更 → done，备注: 完成实施，所有验收标准已通过