---
id: "2026-01-24-设计自动化插件加载系统"
title: "前端自动化插件加载系统"
status: "in-progress"
created: "2026-01-24"
updated: "2026-01-24"
category: "architecture"
tags: ["plugin", "automation", "frontend"]
---

# Issue: 前端自动化插件加载系统

## Goal

让前端自动发现和加载插件，无需手动在 MarkdownRenderer.tsx 中集成每个库。

## 背景/问题

### 现状
**服务端**（已自动化 ✅）：
```typescript
// 自动发现和加载
const pluginManager = new PluginManager({ pluginPaths: ['plugins'] });
await pluginManager.discover();
await pluginManager.loadAll();
```

**前端**（手动集成 ❌）：
```typescript
// 需要手动写代码
import mermaid from 'mermaid';
const renderMermaidDiagrams = async () => { /* 手动实现 */ };
```

### 问题
1. 添加新插件需要改多处代码
2. 前端和服务端配置不一致
3. 代码重复

## 解决方案

### 核心思路：统一配置 + 自动加载

**Step 1**: 在 manifest.json 中定义前端配置
**Step 2**: 创建通用的前端渲染器
**Step 3**: 自动扫描和注册

## 实施计划

### Phase 1: 扩展 manifest.json
```json
{
  "id": "mermaid-renderer",
  "capabilities": [{
    "type": "renderer",
    "name": "mermaid",
    "frontend": {
      "codeBlockLang": ["mermaid", "mmd"],
      "library": "mermaid",
      "renderFunction": "render"
    }
  }]
}
```

### Phase 2: 创建通用渲染器
文件：`src/client/lib/plugin-renderer.ts`

功能：
- 读取所有 manifest.json
- 自动生成 remark 插件
- 自动注册渲染函数

### Phase 3: 集成到 MarkdownRenderer
```typescript
// 自动加载所有插件
import { PluginRenderer } from '../lib/plugin-renderer';
const pluginRenderer = new PluginRenderer();
await pluginRenderer.renderAll(container);
```

## 验收标准

- [ ] 添加新插件只需创建 manifest.json
- [ ] 前端自动发现和加载插件
- [ ] 无需修改 MarkdownRenderer.tsx

## 相关资源

- [x] `src/server/lib/plugin-manager.ts` - 服务端实现
- [x] `plugins/*/manifest.json` - 插件配置
- [ ] 待创建: `src/client/lib/plugin-renderer.ts`

---

## Status 更新日志

- **2026-01-24 02:00**: 创建 Issue，分析现状
